Inline teaser editing
=====================

The CPE allows inline teaser editing.

Prepare a CP and open the form:

>>> import zope.testbrowser.testing
>>> browser = zope.testbrowser.testing.Browser()
>>> browser.addHeader('Authorization', 'Basic user:userpw')
>>> import zeit.content.cp.browser.testing
>>> zeit.content.cp.browser.testing.create_cp(browser)
>>> browser.open('contents')
>>> contents_url = browser.url
>>> browser.open(
...  'lead/@@landing-zone-drop?uniqueId=http://xml.zeit.de/testcontent')
>>> browser.open(contents_url)
>>> browser.getLink('Edit teaser list').click()
>>> lightbox_url = browser.url


Editing article teaser
----------------------

>>> browser.getLink('Edit').click()

Change the title in the article directly:

>>> browser.getControl('Teaser title').value = 'New article teaser'
>>> browser.getControl('Apply for article').click()
>>> print browser.contents
<...
  <script language="javascript">
    self.clean = true;
    self.close();
  </script>
  ...


The changed values are visible in the CPE:

>>> browser.open(contents_url)
>>> print browser.contents
<...
    <div class="teaser">
      <div class="supertitle"></div>
      <div class="teaserTitle">New article teaser</div>
      <div class="teaserText"></div>
      <span class="uniqueId">http://xml.zeit.de/testcontent</span>
    </div>
...


Free teasers
------------

Free teasers are stored *in* the CP.

Create a free teaser:

>>> browser.open(lightbox_url)
>>> browser.getLink('Edit').click()
>>> browser.getControl('Teaser title').value = 'Local teaser title'
>>> browser.getControl('Apply only for this page').click()

The local teaser title is now visible in the CP:

>>> browser.open(contents_url)
>>> print browser.contents
<...
    <div class="teaser">
      <div class="supertitle"></div>
      <div class="teaserTitle">Local teaser title</div>
      <div class="teaserText"></div>
      <span class="uniqueId">http://teaser.vivi.zeit.de/http://xml.zeit.de/online/2007/01/island#cb53941e-dff7-4bd6-b0c6-eea584f27c65</span>
    </div>
...


The lightbox doesn't show the aricle save button now:

>>> browser.open(lightbox_url)
>>> browser.getLink('Edit').click()
>>> browser.getControl('Apply for article')
Traceback (most recent call last):
    ...
LookupError: label 'Apply for article'...

Changing the free teaser is still possible:

>>> browser.getControl('Teaser title').value = 'New local teaser title'
>>> browser.getControl('Apply only for this page').click()
>>> browser.open(contents_url)
>>> print browser.contents
<...
    <div class="teaser">
      <div class="supertitle"></div>
      <div class="teaserTitle">New local teaser title</div>
      <div class="teaserText"></div>
      <span class="uniqueId">http://teaser.vivi.zeit.de/http://xml.zeit.de/online/2007/01/island#cb53941e-dff7-4bd6-b0c6-eea584f27c65</span>
    </div>
...
